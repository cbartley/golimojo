<html>
    <head>
        <title>Golimojo</title>
        
        <link rel=stylesheet href="golimojo.css" type="text/css">
        
        <script>

            // ---------------------------------------- proxying
    
            function createProxyUrl(url)
            {
                if (!url.match(/^http:\/\//))
                {
                    url = "http://" + url;
                }

                var strippedUrl = url.replace(/^http:\/\//, "");
                var escapedStrippedUrl = escape(strippedUrl);
                var proxyServletUrl = "http://{{localName}}:{{localPort}}/proxy.html?";
                var proxyUrl = proxyServletUrl + escapedStrippedUrl;
                return proxyUrl;
            }
        
            function proxyUrl(url)
            {
                location = createProxyUrl(url);
            }
            
            function createBookmarklet()
            {
                var bookmarklet = 
                    "javascript:location = ((#createProxyUrl#)(location.href))"
                        .replace(/#createProxyUrl#/, createProxyUrl.toString())
                                .replace(/"/g, "'");
                return bookmarklet;
            }
            
            function blockClick(event)
            {
                // If there's a click message, then show it.
                var clickMessage = this.getAttribute("custom-click-message");
                if (clickMessage != null)
                {
                    alert(clickMessage);
                }

                // Cancel the event so that the link is not followed.
                if (event.preventDefault)
                {
                    event.preventDefault();     // for Firefox
                }
                return false;                   // for IE
            }

            function insertBookmarklet(anchorText, clickMessage)
            {
                var html = 
                    '<a onclick="return blockClick.call(this, event) "'
                        + 'custom-click-message="#clickMessage#" href="#bookmarklet#">#anchorText#</a>'
                                .replace(/#anchorText#/, anchorText)
                                    .replace(/#clickMessage#/, clickMessage)
                                        .replace(/#bookmarklet#/, createBookmarklet());
                document.write(html);
            }

            // ---------------------------------------- behavior framework
        
            function dumpError(e)
            {
                var lineList = [];
                for (var id in e)
                {
                    var value = e[id];
                    if (typeof(value) == "string")
                    {
                        var line = "[" + id + "]\t==> " + value;
                        lineList.push(line);
                    }
                }
                return lineList.join("\n");
            }
            
            function typeCheck(obj, constructor)
            {
                if (obj == null) throw new Error("typeCheck: object was null!");
                if (obj.constructor != constructor) throw new Error("typeCheck: type mismatch");
                return obj;
            }

            function createThunk(fun, receiver, thunkName)
            {
                function thunk()
                {
                    try
                    {
                        return fun.apply(receiver, arguments);
                    }
                    catch (e)
                    {
                        alert(thunkName + " thunk error: " + dumpError(e));
                        throw e;
                    }
                }
                
                return thunk;
            }

            function attachEventHandlers(elem, behavior)
            {
                for (var id in behavior)
                {
                    if (id.substring(0, 2) == "on")
                    {
                        elem[id] = createThunk(behavior[id], behavior, id);
                    }
                }
            }

            function attachBehavior(elem, behaviorBag, parentBehavior)
            {
                var behaviorName = elem.getAttribute("custom-behavior");
                if (behaviorName == null) return null;
                var behaviorConstructor = behaviorBag[behaviorName];
                if (behaviorConstructor == null) return null;
                var behavior = new behaviorConstructor(elem, parentBehavior);
                attachEventHandlers(elem, behavior);
                return behavior;
            }           
            
            function recursiveAttachBehaviors(rootElem, behaviorBag, parentBehavior)
            {
                var behavior = attachBehavior(rootElem, behaviorBag, parentBehavior);
                if (behavior != null)
                {
                    parentBehavior = behavior;
                }
                
                var childNodes = rootElem.childNodes;
                for (var i = 0; i < childNodes.length; i++)
                {
                    var childNode = childNodes[i];
                    if (childNode.nodeType == 1)
                    {
                        recursiveAttachBehaviors(childNode, behaviorBag, parentBehavior);
                    }
                
                }
            }

            // ---------------------------------------- class TabSet

            function TabSet(elem, parentBehavior)
            {
                this.tabList = [];
            }
            
            TabSet.prototype.registerTab = function (tab)
            {
                this.tabList.push(tab);
            }
            
            TabSet.prototype.selectTab = function (tabToSelect)
            {
                tabToSelect.select();
                for (var i = 0; i < this.tabList.length; i++)
                {
                    var tab = this.tabList[i];
                    if (tab != tabToSelect)
                    {
                        tab.unselect();
                    }
                }
            }

            // ---------------------------------------- class Tab

            function Tab(elem, parentBehavior)
            {
                this.elem = elem;
                this.tabSet = typeCheck(parentBehavior, TabSet);
                this.targetElem = document.getElementById(elem.getAttribute("custom-target-id"));
                this.tabSet.registerTab(this);
                
                var queryString = elem.href.replace(/[^?]*/, "");
                if (location.search == queryString)
                {
                    this.select();
                }
                else
                {
                    this.unselect();
                }
            }
            
            Tab.prototype.select = function ()
            {
                this.elem.className = this.elem.className.replace(/tab-unselected/, "tab-selected");
                this.targetElem.className = this.targetElem.className.replace(/page-unselected/, "page-selected");          
            }

            Tab.prototype.unselect = function ()
            {
                this.elem.className = this.elem.className.replace(/tab-selected/, "tab-unselected");            
                this.targetElem.className = this.targetElem.className.replace(/page-selected/, "page-unselected");          
            }

            // ---------------------------------------- class StackedTab
            
            function StackedTab(elem, parentBehavior)
            {
                this.elem = elem;
                this.tabSet = typeCheck(parentBehavior, TabSet);
                this.targetElem = document.getElementById(elem.getAttribute("custom-target-id"));
                this.tabSet.registerTab(this);
            }
            
            StackedTab.prototype.select = function ()
            {
                this.elem.style.zIndex = "100";
            }

            StackedTab.prototype.unselect = function ()
            {
                // IE and Firefox seem to have some disagreement about z-index.
                this.elem.style.zIndex = (document.all) ? "-1" : "0";
            }

            StackedTab.prototype.onclick = function ()
            {
                this.tabSet.selectTab(this);
            }

            // ---------------------------------------- class ProxyLink
            
            function ProxyLink(elem, parentBehavior)
            {
                if (elem.href != null)
                {
                    elem.href = createProxyUrl(elem.href);
                }
            }

            // ---------------------------------------- window onload

            window.onload = function ()
            {
                var behaviorBag = {"tab-set": TabSet, "tab": Tab, "stacked-tab": StackedTab, "proxy-link": ProxyLink};
                recursiveAttachBehaviors(document.body, behaviorBag);
            }

        </script>

    </head>
    <body>
    
        <table class="tab-table">
        
            <tr>
                <td>
                    
                </td>
                
                <td>
                    <h2>Golimojo</h2>
                </td>

            </tr>
            
            <tr>
                <td custom-behavior="tab-set" class="tab-bar">
                
                    <a custom-behavior="tab" custom-target-id="page-introduction" class="tab tab-unselected" href="index.html">Introduction/Overview</a>
                    <a custom-behavior="tab" custom-target-id="page-examples" class="tab tab-unselected" href="index.html?examples">Examples</a>
                    <a custom-behavior="tab" custom-target-id="page-try" class="tab tab-unselected" href="index.html?try">Try It Out</a>
                    <a custom-behavior="tab" custom-target-id="page-bookmarklet" class="tab tab-unselected" href="index.html?bookmarklet">Bookmarklet</a>
                    <a custom-behavior="tab" custom-target-id="page-extension" class="tab tab-unselected" href="index.html?extension">Firefox Extension</a>

                </td>
                
                <td class="content-bay">
                
                
                    <!-------------------------------------------------------------->

                    <div class="page page-selected" id="page-introduction">
                    
                        <h2>Introduction</h2>
                    
                        <p>
                            <b>Golimojo</b> scans the text on a web page, looking for words and phrases that
                            can be linked to Wikipedia articles of the same name.  When matching words or
                            phrases are found, they are turned into hyperlinks right on the web page.  The 
                            screenshots below illustrate what this looks like.  Click on the <b>Before</b>
                            tab to see the "before" screenshot in its entirety.
                            The <b><a href="index.html?examples">Examples</a></b> page 
                            has links to more examples.
                        </p>

                        <div custom-behavior="tab-set" class="screenshot-stack">
                            <img custom-behavior="stacked-tab" class="screenshot-before" src="screenshot-before-small.png">
                            <img custom-behavior="stacked-tab" class="screenshot-after" src="screenshot-after-small.png">
                        </div>

                    </div>

                    <!-------------------------------------------------------------->
                
                    <div class="page page-unselected" id="page-examples">
                    
                        <h2>Examples</h2>
                        
                        <div>
                            This page contains a selection of web pages that can be viewed using the Golimojo
                            proxy service.  Or you can go directly to the <a href="index.html?try">Try It Out</a>
                            page to try Golimojo on web pages of your own choosing.
                        </div>

                        <ul class="examples">
                        
                            <li>
                                <a href="http://www.intel-dump.com/posts/1146979959.shtml" custom-behavior="proxy-link">
                                Phil Carter's review</a> of Richard Rhodes' <b>The Making of the Atomic Bomb</b> on the Intel Dump blog.
                            </li>

                            <li>
                                <a href="http://www.economist.com/displaystory.cfm?story_id=1337165" custom-behavior="proxy-link">
                                The clockwork computer</a>: An article in The Economist about the <i>Antikythera mechanism</i>, 
                                an ancient Greek device for computing astronomical dates.
                            </li>

                            <li>
                                <a href="http://www.washingtonpost.com/wp-dyn/content/article/2006/07/21/AR2006072101515.html" custom-behavior="proxy-link">
                                An Electric Car With Juice</a>: A Washington Post article about the all-electric Tesla Roadster.
                            </li>
                        
                            <li>
                                <a href="http://seattlepi.nwsource.com/local/260744_kennewick24.html" custom-behavior="proxy-link">
                                Kennewick Man buried by others, scientist finds</a>: An article in the Seattle Post-Intelligencer
                                about 9,000 year-old remains discovered on the banks of the Columbia River in 1996.
                            </li>

                            <li>
                                <a href="http://www.newyorker.com/fact/content/articles/060731fa_fact" custom-behavior="proxy-link">
                                Can Wikipedia conquer expertise?</a> -- an article in The New Yorker about Wikipedia.
                            </li>
                            
                            <li>
                                <a href="http://www.discover.com/issues/feb-06/features/megadeath-in-mexico/" custom-behavior="proxy-link">
                                Megadeath in Mexico</a> -- A Discover Magazine article about a theory that epidemics in
                                post-conquest Mexico might have been hemorrhagic fever rather than smallpox.
                            </li>
                            
                            <li>
                                <a href="http://www.msnbc.msn.com/id/12502996/" custom-behavior="proxy-link">
                                Olive branch solves a Bronze Age mystery</a> -- an MSNBC article about dating
                                several ancient Mediterranean civilizations.
                            
                            </li>

                        </ul>
                        
                        
                        

                    </div>
                
                    <!-------------------------------------------------------------->
                
                    <div class="page page-unselected" id="page-try">
                    
                    
                        <style>         

                            .url-label
                            {
                                font-weight: bold;
                            }

                            #url-input
                            {
                                width: 30em;
                                margin-right: 0.3em;
                            }
                        </style>
                        
                        <h2>Try It Out</h2>
                        
                        <p>
                            The Golimojo proxy service is the easiest way to use Golimojo to
                            add links to arbitrary web pages.  To use the proxy service, 
                            simply enter a URL into the text box below and hit <b>Go</b>.
                            Or you can check out the
                            <a href="index.html?bookmarklet">Golimojo Bookmarklet</a> for
                            an even more convenient way to use Golimojo.
                        </p>

                        <p>
                            <form action="javascript:proxyUrl(document.getElementById('url-input').value)">
                                <label class="url-label">URL:</label> 
                                <input id="url-input" type="text">
                                <button type="submit">Go</button>
                            </form>
                        </p>

                    </div>
                
                    <!-------------------------------------------------------------->
                
                    <div class="page page-unselected" id="page-bookmarklet">
                        
                        <h2>The Bookmarklet</h2>
            
                        <p>
                            The Golimojo <b>bookmarklet</b> allows you to invoke the 
                            Golimojo proxy service directly on the page you are looking at.
                            You just need to save the bookmarklet as a bookmark or favorite.
                            Then you can select it from your bookmarks/favorites menu at 
                            any time, and the page you are currently viewing will be
                            reloaded through the Golimojo proxy service.
                        </p>
                        
                        <h2>Installing the Bookmarklet</h2>

                        <p>
                        
                            Installing the bookmarklet is easy.  
                            
                            <ol>
                                                    
                                <li>
                                    Right-click (Ctrl-click on the Macintosh) the bookmarklet link below.
                                    This will bring up the context menu.
                                </li>
                                
                                <li>
                                    From the context menu you want to select <b>Bookmark this Link...</b> 
                                    (Firefox) or <b>Add to Favorites...</b> (Internet Explorer).
                                </li>
                                
                                <li>
                                    Click <b>Ok</b> in the dialog box.
                                </li>
                                
                            </ol>
                            
                        </p>
                        
                        <div class="bookmarklet-box">
                            <script>
                                insertBookmarklet("Golimojo Bookmarklet Link", "Right-click, please!");
                            </script>
                        </div>
                        
                        <h2>Using the Bookmarklet</h2>
                        
                        <p>
                        If you open the <b>Bookmarks</b> or <b>Favorites</b> menu in your browser, you
                        should see the <b>Golimojo Bookmarklet</b>.  To invoke the bookmarklet on
                        whatever page you are currently viewing just select it from the menu.
                        </p>

                    </div>
                    
                    <!-------------------------------------------------------------->
            
                    <div class="page page-unselected" id="page-extension">

                        <h2>Firefox Extension</h2>
                        
                        <p>
                            <i>Coming Soon.</i>
                        </p>

                    </div>

                </td>
                
                
            </tr>
    
        </table>
    
    
    
    
    
    
    
    
    
    
    </body>
</html>
